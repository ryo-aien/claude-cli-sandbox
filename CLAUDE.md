# Claude CLI 使用ガイド

このドキュメントでは、Claude CLI Sandbox 環境での Claude CLI の使い方を説明します。

## Claude CLI とは

Claude CLI は、Anthropic が提供する AI アシスタント「Claude」をコマンドラインから利用できるツールです。コードの生成、バグ修正、リファクタリング、ドキュメント作成など、様々な開発タスクをサポートします。

## 基本的な使い方

### 起動

コンテナ内で以下のコマンドを実行：

```bash
claude
```

初回起動時は、ブラウザで認証ページが開きます。Anthropic アカウントでログインしてください。

### 終了

以下のいずれかの方法で終了できます：

- `exit` と入力
- `Ctrl+D` を押す
- `Ctrl+C` を押す

## 主な使用例

### 1. コードの生成

```
プロンプト: Python でフィボナッチ数列を計算する関数を書いてください
```

Claude が関数を生成し、ファイルに保存するか尋ねます。

### 2. バグ修正

```
プロンプト: app.py の 42 行目でエラーが発生しています。修正してください
```

Claude がファイルを読み込み、問題を分析して修正を提案します。

### 3. コードレビュー

```
プロンプト: src/main.py をレビューして、改善点を教えてください
```

Claude がコードを分析し、改善提案を行います。

### 4. リファクタリング

```
プロンプト: utils.py をよりモダンな Python コードにリファクタリングしてください
```

Claude がコードを読み込み、リファクタリングを提案します。

### 5. ドキュメント作成

```
プロンプト: api.py のドキュメント文字列を追加してください
```

Claude が関数やクラスにドキュメントを追加します。

### 6. テストコード生成

```
プロンプト: calculator.py の単体テストを作成してください
```

Claude がテストコードを生成します。

## 便利な機能

### ファイル編集の確認

Claude がファイルを編集する際、変更内容を確認してから適用できます。以下のように表示されます：

```
Claude: 以下の変更を適用しますか？

--- app.py
+++ app.py
@@ -1,5 +1,5 @@
-def add(a, b):
-    return a + b
+def add(a: int, b: int) -> int:
+    return a + b

[y/n]:
```

### マルチファイル操作

Claude は複数のファイルを同時に操作できます：

```
プロンプト: src/ ディレクトリ内のすべての Python ファイルに型ヒントを追加してください
```

### コンテキストの保持

Claude は会話の履歴を保持しているため、前の文脈を参照できます：

```
ユーザー: calculator.py を作成してください
Claude: [calculator.py を作成]

ユーザー: それにテストも追加してください
Claude: [test_calculator.py を作成]
```

## コマンドとショートカット

### 特殊コマンド

Claude CLI 内で使用できる特殊コマンド：

- `/help`: ヘルプを表示
- `/clear`: 会話履歴をクリア
- `/exit`: Claude CLI を終了

### シェルコマンドの実行

Claude に依頼すれば、シェルコマンドも実行できます：

```
プロンプト: requirements.txt に記載されているパッケージをインストールしてください
```

Claude が `pip install -r requirements.txt` を実行します（ガードレールにより確認が求められます）。

## ベストプラクティス

### 1. 具体的な指示を出す

**悪い例**:
```
コードを良くしてください
```

**良い例**:
```
app.py の関数名を PEP 8 に準拠した命名規則に変更してください
```

### 2. ファイルパスを明示する

**悪い例**:
```
この関数を修正してください
```

**良い例**:
```
src/utils.py の parse_data 関数を修正してください
```

### 3. 変更の範囲を限定する

**悪い例**:
```
プロジェクト全体をリファクタリングしてください
```

**良い例**:
```
models/user.py の User クラスをリファクタリングしてください
```

### 4. エラーメッセージを共有する

エラーが発生した場合は、エラーメッセージを含めて依頼：

```
プロンプト: 以下のエラーを修正してください：

Traceback (most recent call last):
  File "app.py", line 10, in <module>
    result = divide(10, 0)
ZeroDivisionError: division by zero
```

### 5. 段階的に進める

大きなタスクは小さなステップに分けて依頼：

```
1. まず、User モデルを作成してください
2. 次に、User モデルの CRUD 操作を追加してください
3. 最後に、テストを作成してください
```

## 制限事項と注意点

### ガードレールによる制限

以下のコマンドは実行できません：

- システムの破壊的操作（`rm -rf /` など）
- ルートディレクトリのパーミッション変更
- Git の強制プッシュやハードリセット
- `/workspace` 以外のディレクトリへのファイル編集

### パッケージインストール

`npm install` や `apt install` などのコマンドは、実行前に確認が求められます。

### ファイルの読み書き

Claude は `/workspace` ディレクトリ（プロジェクトルート）内のファイルのみ編集できます。

## トラブルシューティング

### Claude が応答しない

```bash
# Claude CLI を再起動
exit
claude
```

### ファイルが見つからないと言われる

```bash
# 現在のディレクトリを確認
pwd

# ファイルの存在を確認
ls -la
```

### 認証エラーが発生する

```bash
# 認証情報をリセット
rm -rf ~/.config/claude/

# Claude CLI を再起動して再認証
claude
```

### 変更が保存されない

ホスト側のエディタでファイルを開いている場合、エディタを再読み込みしてください。

## よくある質問

### Q: Claude CLI は無料で使えますか？

A: Anthropic のアカウントに基づいた利用プランが適用されます。詳細は Anthropic の公式サイトを確認してください。

### Q: インターネット接続は必要ですか？

A: はい、Claude CLI は Anthropic の API と通信するため、インターネット接続が必要です。

### Q: 複数のプロジェクトで使用できますか？

A: はい、`CLAUDE_WORKSPACE_DIR` 環境変数を変更することで、異なるプロジェクトディレクトリを指定できます。

### Q: Claude CLI の設定をカスタマイズできますか？

A: はい、`~/.config/claude/` ディレクトリ内の設定ファイルを編集できます。

### Q: 会話履歴は保存されますか？

A: はい、会話履歴はコンテナ内の `~/.config/claude/` に保存されます。コンテナを削除すると履歴も削除されます。

## 参考リソース

- [Anthropic 公式ドキュメント](https://docs.anthropic.com/)
- [Claude CLI GitHub リポジトリ](https://github.com/anthropics/claude-cli)

## フィードバックとサポート

Claude CLI に関する問題や提案がある場合は、Anthropic の公式サポートチャンネルまでお問い合わせください。

---

**Happy Coding with Claude CLI!**
